<!DOCTYPE html>
<html lang="en">

<head>
    <title>3D Model-Bird</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            background-color: #bfe3dd;
            color: #000;
        }
    </style>
</head>

<body>
    <div id="container"></div>

    <script type="module">
        import * as THREE from './build/three.module.js';
        import Stats from './jsm/libs/stats.module.js';

        import { OrbitControls } from './jsm/controls/OrbitControls.js';
        //  import { RoomEnvironment } from './jsm/environments/RoomEnvironment.js';

        import { GLTFLoader } from './jsm/loaders/GLTFLoader.js';
        import { DRACOLoader } from './jsm/loaders/DRACOLoader.js';

        let mixer, mixer1, mixer2, mixer3, mixer4, mixerTokyo;
        let model1;

        const clock = new THREE.Clock();
        const container = document.getElementById('container');

        const stats = new Stats();
        container.appendChild(stats.dom);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.outputEncoding = THREE.sRGBEncoding;
        container.appendChild(renderer.domElement);

        //
        renderer.shadowMap.enabled = true;


        const pmremGenerator = new THREE.PMREMGenerator(renderer);

        const scene = new THREE.Scene();
        //scene.background = new THREE.Color(0xbfe3dd);
        // scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

        //
        scene.background = new THREE.Color(0xcce0ff);
        scene.fog = new THREE.Fog(0xcce0ff, 500, 10000);

        //
        scene.add(new THREE.AmbientLight(0x666666));

        const light = new THREE.DirectionalLight(0xdfebff, 1);
        light.position.set(50, 200, 100);
        light.position.multiplyScalar(1.3);

        light.castShadow = true;

        light.shadow.mapSize.width = 1024;
        light.shadow.mapSize.height = 1024;

        const d = 300;

        light.shadow.camera.left = - d;
        light.shadow.camera.right = d;
        light.shadow.camera.top = d;
        light.shadow.camera.bottom = - d;

        light.shadow.camera.far = 1000;

        scene.add(light);



        // const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 100);
        // camera.position.set(6, 2, 8);

        const camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 10000);
        camera.position.set(1000, 50, 1500);


        // ground
        const texture_loader = new THREE.TextureLoader();
        const groundTexture = texture_loader.load('terrain/grasslight-big.jpg');
        groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
        groundTexture.repeat.set(25, 25);
        groundTexture.anisotropy = 16;
        groundTexture.encoding = THREE.sRGBEncoding;

        const groundMaterial = new THREE.MeshLambertMaterial({ map: groundTexture });

        let mesh = new THREE.Mesh(new THREE.PlaneGeometry(20000, 20000), groundMaterial);
        mesh.position.y = -250;
        mesh.rotation.x = - Math.PI / 2;
        mesh.receiveShadow = true;
        scene.add(mesh);






        const controls = new OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 0.5, 0);
        controls.update();
        controls.enablePan = false;
        controls.enableDamping = true;

        const dracoLoader = new DRACOLoader();
        dracoLoader.setDecoderPath('js/libs/draco/gltf/');

        const loader = new GLTFLoader();
        loader.setDRACOLoader(dracoLoader);
        loader.load('models/Stork.glb', function (gltf) {
            model1 = gltf.scene;
            model1.position.set(911, 78, 1050);
            model1.rotation.set(0, -.3, 0);
            model1.scale.set(0.04, 0.04, 0.04);
            scene.add(model1);

            mixer = new THREE.AnimationMixer(model1);
            mixer.clipAction(gltf.animations[0]).play();
        }, undefined, function (e) {
            console.error(e);
        });


        loader.load('models/Stork.glb', function (gltf) {
            const model = gltf.scene;
            model.position.set(905, 75, 1050);
            model.rotation.set(0, -.3, 0);
            model.scale.set(0.03, 0.03, 0.03);
            scene.add(model);

            mixer1 = new THREE.AnimationMixer(model);
            mixer1.clipAction(gltf.animations[0]).play();

        }, undefined, function (e) {
            console.error(e);
        });

        loader.load('models/Stork.glb', function (gltf) {
            const model2 = gltf.scene;
            model2.position.set(918, 75, 1055);
            model2.rotation.set(0, -.3, 0);
            model2.scale.set(0.03, 0.03, 0.03);
            scene.add(model2);

            mixer2 = new THREE.AnimationMixer(model2);
            mixer2.clipAction(gltf.animations[0]).play();


        }, undefined, function (e) {
            console.error(e);
        });

        loader.load('models/Stork.glb', function (gltf) {
            const model = gltf.scene;
            model.position.set(900, 72, 1050);
            model.rotation.set(0, -.3, 0);
            model.scale.set(0.03, 0.03, 0.03);
            scene.add(model);

            mixer3 = new THREE.AnimationMixer(model);
            mixer3.clipAction(gltf.animations[0]).play();


        }, undefined, function (e) {
            console.error(e);
        });

        loader.load('models/Stork.glb', function (gltf) {
            const model = gltf.scene;
            model.position.set(925, 72, 1058);
            model.rotation.set(0, -.3, 0);
            model.scale.set(0.03, 0.03, 0.03);
            scene.add(model);

            mixer4 = new THREE.AnimationMixer(model);
            mixer4.clipAction(gltf.animations[0]).play();

            animate();
        }, undefined, function (e) {
            console.error(e);
        });

        loader.setDRACOLoader(dracoLoader);
        loader.load('models/LittlestTokyo.glb', function (gltf) {

            const model = gltf.scene;
            model.position.set(500, -110, 0);
            model.rotation.set(0, 3, 0);
            model.scale.set(0.5, 0.7, 0.5);
            scene.add(model);

            mixerTokyo = new THREE.AnimationMixer(model);
            mixerTokyo.clipAction(gltf.animations[0]).play();

            animate();

        }, undefined, function (e) {

            console.error(e);

        });




        window.onresize = function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };


        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            mixer.update(delta);
            mixer1.update(delta);
            mixer2.update(delta);
            mixer3.update(delta);
            mixer4.update(delta);
            mixerTokyo.update(delta);
            controls.update();
            stats.update();
            renderer.render(scene, camera);
        }
    </script>
</body>

</html>